<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<title>倒産ニュースまとめ</title>
<style>
  *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
  body{font-family:'Segoe UI','Hiragino Sans','Meiryo',sans-serif;background:#f0f2f5;color:#333;line-height:1.6}

  /* Header */
  header{background:linear-gradient(135deg,#1a1a2e,#16213e);color:#fff;padding:24px 0;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,.3)}
  header h1{font-size:1.8rem;letter-spacing:.05em}
  header h1 span{color:#e74c3c}
  .last-updated{font-size:.85rem;color:#aab;margin-top:6px}

  /* Controls */
  .controls{max-width:1200px;margin:20px auto;padding:0 16px;display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .search-box{flex:1;min-width:200px;padding:10px 16px;border:1px solid #ccc;border-radius:8px;font-size:1rem;outline:none;transition:border-color .2s}
  .search-box:focus{border-color:#3498db}
  .btn{padding:10px 20px;border:none;border-radius:8px;font-size:.95rem;cursor:pointer;transition:background .2s,transform .1s}
  .btn:active{transform:scale(.97)}
  .btn-primary{background:#3498db;color:#fff}
  .btn-primary:hover{background:#2980b9}

  /* Status */
  .status{text-align:center;padding:12px;font-size:.9rem;color:#666}
  .status.error{color:#e74c3c}

  /* Card Grid */
  .card-grid{max-width:1200px;margin:0 auto 40px;padding:0 16px;display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:20px}

  /* Card */
  .card{background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.08);overflow:hidden;transition:transform .2s,box-shadow .2s;display:flex;flex-direction:column}
  .card:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(0,0,0,.12)}
  .card a{text-decoration:none;color:inherit;display:flex;flex-direction:column;flex:1;padding:20px 24px}
  .card-source{font-size:.75rem;color:#fff;background:#e74c3c;display:inline-block;padding:2px 10px;border-radius:4px;margin-bottom:10px;align-self:flex-start}
  .card-title{font-size:1.05rem;font-weight:700;margin-bottom:8px;line-height:1.5;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
  .card-date{font-size:.8rem;color:#888;margin-bottom:8px}
  .card-desc{font-size:.88rem;color:#555;flex:1;display:-webkit-box;-webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden}

  /* Footer */
  footer{background:#1a1a2e;color:#aab;text-align:center;padding:20px 16px;font-size:.8rem;line-height:1.8}

  /* Loading spinner */
  .spinner{display:inline-block;width:20px;height:20px;border:3px solid #ccc;border-top-color:#3498db;border-radius:50%;animation:spin .6s linear infinite;vertical-align:middle;margin-right:6px}
  @keyframes spin{to{transform:rotate(360deg)}}

  /* No results */
  .no-results{text-align:center;padding:60px 16px;color:#888;font-size:1.1rem}

  /* Responsive */
  @media(max-width:600px){
    header h1{font-size:1.3rem}
    .card-grid{grid-template-columns:1fr}
    .controls{flex-direction:column}
    .btn{width:100%}
  }
</style>
</head>
<body>

<header>
  <h1><span>&#x1F4C9;</span> 倒産ニュースまとめ</h1>
  <div class="last-updated" id="lastUpdated">読み込み中...</div>
</header>

<div class="controls">
  <input type="text" class="search-box" id="searchBox" placeholder="キーワードで絞り込み...">
  <button class="btn btn-primary" id="refreshBtn">&#x1F504; 更新</button>
</div>

<div class="status" id="status"></div>
<div class="card-grid" id="cardGrid"></div>

<footer>
  <p>※ 本サイトはGoogle Newsから自動取得した情報を表示しています。内容の正確性は各出典元をご確認ください。</p>
  <p>ニュースは30分ごとに自動更新されます。</p>
  <p>&copy; 2026 倒産ニュースまとめ</p>
</footer>

<script>
(function () {
  var cardGrid = document.getElementById('cardGrid');
  var statusEl = document.getElementById('status');
  var lastUpdatedEl = document.getElementById('lastUpdated');
  var searchBox = document.getElementById('searchBox');
  var refreshBtn = document.getElementById('refreshBtn');

  var articles = [];

  // --- Render ---
  function renderCards(data) {
    cardGrid.innerHTML = '';
    if (data.length === 0) {
      cardGrid.innerHTML = '<div class="no-results">該当するニュースが見つかりませんでした。</div>';
      return;
    }
    data.forEach(function (item) {
      var date = item.pubDate ? new Date(item.pubDate) : null;
      var dateStr = date && !isNaN(date) ? date.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' }) : '';

      var card = document.createElement('div');
      card.className = 'card';
      card.innerHTML =
        '<a href="' + escapeAttr(item.link || '#') + '" target="_blank" rel="noopener noreferrer">' +
          (item.source ? '<span class="card-source">' + escapeHtml(item.source) + '</span>' : '') +
          '<div class="card-title">' + escapeHtml(item.title) + '</div>' +
          '<div class="card-date">' + escapeHtml(dateStr) + '</div>' +
          '<div class="card-desc">' + escapeHtml(item.description || '') + '</div>' +
        '</a>';
      cardGrid.appendChild(card);
    });
  }

  function escapeHtml(str) {
    var d = document.createElement('div');
    d.appendChild(document.createTextNode(str));
    return d.innerHTML;
  }

  function escapeAttr(str) {
    return str.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
  }

  // --- Data sources (try raw GitHub first for freshest data, then local) ---
  var DATA_URLS = [
    'https://raw.githubusercontent.com/yukuma-goseahawks/tousan-news/master/news.json',
    'news.json'
  ];

  function fetchNews() {
    statusEl.className = 'status';
    statusEl.innerHTML = '<span class="spinner"></span>ニュースを取得中...';
    cardGrid.innerHTML = '';
    tryFetch(0);
  }

  function tryFetch(index) {
    if (index >= DATA_URLS.length) {
      statusEl.className = 'status error';
      statusEl.textContent = 'ニュースデータの取得に失敗しました。しばらくしてから再度お試しください。';
      lastUpdatedEl.textContent = '';
      return;
    }
    var url = DATA_URLS[index] + '?t=' + Date.now();
    fetch(url)
      .then(function (res) {
        if (!res.ok) throw new Error('HTTP ' + res.status);
        return res.json();
      })
      .then(function (data) {
        if (!data.items || data.items.length === 0) throw new Error('No items');
        articles = data.items;
        statusEl.textContent = '';
        renderCards(filterArticles());
        var fetched = data.fetched ? new Date(data.fetched) : null;
        lastUpdatedEl.textContent = '最終更新: ' + (fetched && !isNaN(fetched) ? fetched.toLocaleString('ja-JP') : '不明');
      })
      .catch(function () {
        tryFetch(index + 1);
      });
  }

  // --- Filter ---
  function filterArticles() {
    var keyword = searchBox.value.trim().toLowerCase();
    if (!keyword) return articles;
    return articles.filter(function (a) {
      return (a.title + ' ' + a.description + ' ' + a.source).toLowerCase().indexOf(keyword) !== -1;
    });
  }

  // --- Events ---
  searchBox.addEventListener('input', function () {
    renderCards(filterArticles());
  });

  refreshBtn.addEventListener('click', function () {
    searchBox.value = '';
    fetchNews();
  });

  // --- Init ---
  fetchNews();
})();
</script>
</body>
</html>
